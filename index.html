<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holland Compass</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: #0d1117; color: #e6e6e6; }
        .spinner { border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid #fb923c; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .nav-link { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .nav-link.active, .nav-link:hover { color: #fb923c; border-bottom-color: #fb923c; }
        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .lang-btn { opacity: 0.6; transition: opacity 0.2s; cursor: pointer; border-radius: 9999px; }
        .lang-btn.active { opacity: 1; box-shadow: 0 0 10px #fb923c; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col">

    <header class="max-w-6xl mx-auto w-full sticky top-4 z-50 bg-gray-900/50 backdrop-blur-sm border border-gray-700 rounded-xl shadow-lg p-4 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <svg class="w-8 h-8 text-orange-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 10V7m0 0l6-3m-6 3L3 4m6 3l6-3m0 0l6 3" /></svg>
            <h1 class="text-2xl font-extrabold text-white">Holland Compass</h1>
        </div>
        <nav class="hidden md:flex items-center gap-6 text-sm font-semibold">
            <a href="#utrecht" class="nav-link active" data-translate="nav_utrecht">Utrecht</a>
            <a href="#cities" class="nav-link" data-translate="nav_cities">Ciudades</a>
            <a href="#trips" class="nav-link" data-translate="nav_trips">Rutas de 1 Día</a>
            <a href="#info" class="nav-link" data-translate="nav_info">Info Práctica</a>
        </nav>
        <div class="flex gap-2">
            <img id="lang-es" src="https://flagcdn.com/es.svg" width="24" alt="Español" class="lang-btn">
            <img id="lang-en" src="https://flagcdn.com/gb.svg" width="24" alt="English" class="lang-btn">
            <img id="lang-gl" src="https://flagcdn.com/es-ga.svg" width="24" alt="Gallego" class="lang-btn">
            <img id="lang-ca" src="https://flagcdn.com/es-ct.svg" width="24" alt="Catalán" class="lang-btn">
        </div>
    </header>

    <main class="max-w-6xl mx-auto w-full mt-10">
        
        <section id="utrecht" class="mb-16 scroll-mt-24">
            <h2 class="text-4xl font-bold text-orange-400 border-b-2 border-orange-400 pb-2 mb-6" data-translate="utrecht_title">Conoce Utrecht</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <img src="https://images.unsplash.com/photo-1596211445290-891d1d54d144?q=80&w=2574&auto=format&fit=crop" class="rounded-lg shadow-lg">
                </div>
                <div class="text-gray-300 space-y-4">
                    <p data-translate="utrecht_desc1">Utrecht, el corazón de los Países Bajos, es una ciudad vibrante llena de historia, canales únicos y una atmósfera acogedora. Es el punto de partida perfecto para explorar el resto del país.</p>
                    <p data-translate="utrecht_desc2">Desde la icónica Torre Dom hasta sus animados cafés junto al agua, Utrecht combina el encanto de una ciudad medieval con la energía de una ciudad universitaria moderna.</p>
                </div>
            </div>
            <div id="utrecht-places" class="mt-8"></div>
        </section>

        <section id="cities" class="mb-16 scroll-mt-24">
            <h2 class="text-4xl font-bold text-orange-400 border-b-2 border-orange-400 pb-2 mb-6" data-translate="cities_title">Otras Ciudades para Explorar</h2>
            <div id="cities-container" class="space-y-12"></div>
        </section>

        <section id="trips" class="mb-16 scroll-mt-24">
             <h2 class="text-4xl font-bold text-orange-400 border-b-2 border-orange-400 pb-2 mb-6" data-translate="trips_title">Rutas de 1 Día</h2>
             <p class="text-gray-400 mb-6" data-translate="trips_subtitle">Planes optimizados para aprovechar al máximo una visita de un día desde Utrecht.</p>
             <div id="trips-container" class="space-y-8"></div>
        </section>

        <section id="info" class="mb-16 scroll-mt-24">
            <h2 class="text-4xl font-bold text-orange-400 border-b-2 border-orange-400 pb-2 mb-6" data-translate="info_title">Info Práctica y Curiosidades</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div id="phrases-section" class="bg-gray-800 p-6 rounded-lg"></div>
                <div id="curiosities-section" class="bg-gray-800 p-6 rounded-lg"></div>
                <div id="transport-section" class="bg-gray-800 p-6 rounded-lg"></div>
                <div id="supermarkets-section" class="bg-gray-800 p-6 rounded-lg"></div>
            </div>
        </section>

        <div id="contact-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 backdrop-blur-sm flex items-center justify-center p-4 z-50"></div>
    </main>

    <footer class="max-w-7xl mx-auto w-full mt-12 py-6 text-center text-gray-500 border-t border-gray-700 text-sm">
        <p>© 2025 Zaswear</p>
        <div class="mt-2 space-x-4">
            <a href="#" class="hover:underline" data-translate="footer_privacy">Política de Privacidad</a>
            <button id="contact-btn" class="hover:underline" data-translate="footer_contact">Contacto</button>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        let db;
        let currentLang = 'es';
        
        // --- CONFIGURACIÓN SEGURA DE FIREBASE ---
        // Lee la configuración desde la variable de entorno de Vercel
        const firebaseConfigString = import.meta.env.VITE_FIREBASE_CONFIG;
        if (!firebaseConfigString) {
            console.error("Firebase config not found. Make sure VITE_FIREBASE_CONFIG is set in Vercel.");
            document.body.innerHTML = '<div class="text-red-500 text-center p-10">Error de configuración: No se encontró la configuración de Firebase.</div>';
        } else {
            const firebaseConfig = JSON.parse(firebaseConfigString);
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            main(); // Llama a la función principal solo si la configuración es exitosa
        }

        const translations = {
            es: { nav_utrecht: "Utrecht", nav_cities: "Ciudades", nav_trips: "Rutas de 1 Día", nav_info: "Info Práctica", utrecht_title: "Conoce Utrecht", utrecht_desc1: "Utrecht, el corazón de los Países Bajos, es una ciudad vibrante...", utrecht_desc2: "Desde la icónica Torre Dom...", cities_title: "Otras Ciudades para Explorar", trips_title: "Rutas de 1 Día", trips_subtitle: "Planes optimizados para aprovechar...", info_title: "Info Práctica y Curiosidades", footer_privacy: "Política de Privacidad", footer_contact: "Contacto", phrases_title: "Frases Frecuentes", curiosities_title: "Curiosidades", transport_title: "Transporte", supermarkets_title: "Supermercados" },
            en: { nav_utrecht: "Utrecht", nav_cities: "Cities", nav_trips: "1-Day Trips", nav_info: "Practical Info", utrecht_title: "Discover Utrecht", utrecht_desc1: "Utrecht, the heart of the Netherlands...", utrecht_desc2: "From the iconic Dom Tower...", cities_title: "Other Cities to Explore", trips_title: "1-Day Trips", trips_subtitle: "Optimized plans to make the most of...", info_title: "Practical Info & Curiosities", footer_privacy: "Privacy Policy", footer_contact: "Contact", phrases_title: "Common Phrases", curiosities_title: "Curiosities", transport_title: "Transport", supermarkets_title: "Supermarkets" },
            gl: { nav_utrecht: "Utrecht", nav_cities: "Cidades", nav_trips: "Rutas de 1 Día", nav_info: "Info Práctica", utrecht_title: "Coñece Utrecht", utrecht_desc1: "Utrecht, o corazón dos Países Baixos...", utrecht_desc2: "Dende a icónica Torre Dom...", cities_title: "Outras Cidades para Explorar", trips_title: "Rutas de 1 Día", trips_subtitle: "Plans optimizados para aproveitar...", info_title: "Info Práctica e Curiosidades", footer_privacy: "Política de Privacidade", footer_contact: "Contacto", phrases_title: "Frases Frecuentes", curiosities_title: "Curiosidades", transport_title: "Transporte", supermarkets_title: "Supermercados" },
            ca: { nav_utrecht: "Utrecht", nav_cities: "Ciutats", nav_trips: "Rutes d'1 Dia", nav_info: "Info Pràctica", utrecht_title: "Coneix Utrecht", utrecht_desc1: "Utrecht, el cor dels Països Baixos...", utrecht_desc2: "Des de la icònica Torre Dom...", cities_title: "Altres Ciutats per Explorar", trips_title: "Rutes d'1 Dia", trips_subtitle: "Plans optimitzats per aprofitar...", info_title: "Info Pràctica i Curiositats", footer_privacy: "Política de Privacitat", footer_contact: "Contacte", phrases_title: "Frases Freqüents", curiosities_title: "Curiositats", transport_title: "Transport", supermarkets_title: "Supermercats" }
        };

        function updateLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${lang}`).classList.add('active');
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) el.textContent = translations[lang][key];
            });
            renderAllSections();
        }
        function t(key) { return translations[currentLang]?.[key] || key; }

        function listenAndRender(containerId, collectionName, filterFn, renderer) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = `<div class="flex justify-center"><div class="spinner"></div></div>`;
            
            onSnapshot(collection(db, collectionName), (snapshot) => {
                const items = [];
                snapshot.forEach(doc => items.push({ id: doc.id, ...doc.data() }));
                const filteredItems = items.filter(filterFn);
                renderer(container, filteredItems);
            }, (error) => {
                container.innerHTML = `<p class="text-red-500">Error al cargar contenido.</p>`;
                console.error(`Error loading ${collectionName}:`, error);
            });
        }

        function renderPlaces(container, places) {
            if (places.length === 0) { container.innerHTML = `<p class="text-gray-500 mt-4">No hay lugares añadidos todavía.</p>`; return; }
            container.innerHTML = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8"></div>';
            const grid = container.querySelector('div');
            places.forEach(place => {
                grid.innerHTML += `
                    <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden">
                        <img src="${place.imageUrl}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h4 class="font-bold text-lg text-white">${place.name[currentLang] || place.name.es}</h4>
                            <p class="text-sm text-gray-400 mt-1">${place.description[currentLang] || place.description.es}</p>
                            <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.address)}" target="_blank" class="text-orange-400 hover:underline text-sm mt-2 inline-block">Ver en Google Maps</a>
                        </div>
                    </div>`;
            });
        }

        function renderCities(container, cities) {
            if (cities.length === 0) { container.innerHTML = `<p class="text-gray-500 mt-4">No hay ciudades añadidas todavía.</p>`; return; }
            container.innerHTML = '';
            cities.forEach(city => {
                container.innerHTML += `
                    <div class="bg-gray-800 rounded-lg shadow-lg overflow-hidden">
                        <img src="${city.imageUrl}" class="w-full h-64 object-cover">
                        <div class="p-6">
                            <h3 class="text-3xl font-bold text-white">${city.name}</h3>
                            <p class="text-gray-400 mt-2">${city.description[currentLang] || city.description.es}</p>
                             <p class="text-sm text-orange-300 mt-4">~ ${city.travelTime} en tren desde Utrecht Centraal</p>
                        </div>
                    </div>`;
            });
        }

        function renderInfo(container, items) {
             const titleKey = container.id.replace('-section', '_title');
             let content = `<h3 class="text-2xl font-bold text-white mb-4" data-translate="${titleKey}">${t(titleKey)}</h3>`;
             if (items.length === 0) {
                 content += `<p class="text-gray-500">No hay contenido todavía.</p>`;
             } else {
                 content += '<div class="space-y-4">';
                 items.forEach(item => {
                     content += `<div class="p-4 bg-gray-900 rounded-md">
                         <p class="font-semibold text-orange-300">${item.title[currentLang] || item.title.es}</p>
                         <p class="text-sm text-gray-400">${item.description[currentLang] || item.description.es}</p>
                     </div>`;
                 });
                 content += '</div>';
             }
             container.innerHTML = content;
        }

        function renderAllSections() {
            if(!db) return;
            listenAndRender('utrecht-places', 'places', p => p.city === 'Utrecht', renderPlaces);
            listenAndRender('cities-container', 'cities', () => true, renderCities);
            listenAndRender('phrases-section', 'info', i => i.category === 'phrase', renderInfo);
            listenAndRender('curiosities-section', 'info', i => i.category === 'curiosity', renderInfo);
            listenAndRender('transport-section', 'info', i => i.category === 'transport', renderInfo);
            listenAndRender('supermarkets-section', 'info', i => i.category === 'supermarket', renderInfo);
        }
        
        function toggleContactModal() {
            const modal = document.getElementById('contact-modal');
            const isOpen = !modal.classList.contains('hidden');
            if (isOpen) { modal.classList.add('hidden'); modal.innerHTML = '';
            } else {
                modal.innerHTML = `
                    <div class="relative w-full max-w-lg bg-gray-800 border border-gray-700 rounded-xl p-6 m-4 modal-enter" onclick="event.stopPropagation()">
                        <button onclick="document.getElementById('contact-modal').classList.add('hidden')" class="absolute top-2 right-4 text-3xl">&times;</button>
                        <h2 class="text-2xl font-bold text-orange-400 mb-4">Contacto</h2><div id="contact-status" class="mb-4"></div>
                        <form id="contact-form">
                            <input type="text" id="subject" placeholder="Asunto" class="w-full p-2 mb-4 rounded bg-gray-700" required>
                            <textarea id="message" rows="5" placeholder="Tu mensaje..." class="w-full p-2 mb-4 rounded bg-gray-700" required></textarea>
                            <button type="submit" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-lg">Enviar</button>
                        </form>
                    </div>`;
                modal.classList.remove('hidden');
                modal.onclick = () => modal.classList.add('hidden');
                document.getElementById('contact-form').onsubmit = async (e) => {
                    e.preventDefault();
                    const btn = e.target.querySelector('button'); btn.disabled = true; btn.innerHTML = '<span class="spinner"></span>';
                    const statusDiv = document.getElementById('contact-status');
                    try {
                        const response = await fetch('/api/sendEmail', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ subject: document.getElementById('subject').value, message: document.getElementById('message').value }) });
                        const result = await response.json();
                        if (!response.ok) throw new Error(result.message);
                        statusDiv.innerHTML = '<span class="text-green-400">¡Correo enviado con éxito!</span>';
                        setTimeout(() => modal.classList.add('hidden'), 2000);
                    } catch (error) { statusDiv.innerHTML = `<span class="text-red-400">Error: ${error.message}</span>`; btn.disabled = false; btn.innerHTML = 'Enviar'; }
                };
            }
        }
        window.toggleContactModal = toggleContactModal;

        function main() {
            document.getElementById('contact-btn').onclick = toggleContactModal;
            document.getElementById('lang-es').onclick = () => updateLanguage('es');
            document.getElementById('lang-en').onclick = () => updateLanguage('en');
            document.getElementById('lang-gl').onclick = () => updateLanguage('gl');
            document.getElementById('lang-ca').onclick = () => updateLanguage('ca');

            const savedLang = localStorage.getItem('language') || 'es';
            updateLanguage(savedLang);
        }
    </script>
</body>
</html>

